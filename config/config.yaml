# =============================================================================
# Multimodal Pothole Detection System - Master Configuration
# =============================================================================
# This configuration file controls all system parameters including model paths,
# thresholds, and pipeline settings. Designed for easy deployment and tuning.
# =============================================================================

# -----------------------------------------------------------------------------
# Project Paths
# -----------------------------------------------------------------------------
paths:
  # Data directories
  data_root: "Datasets"
  image_data: "Datasets/images"
  pothole_image_data: "Datasets/Pothole_Image_Data"
  accel_data: "Datasets/Pothole"
  
  # Output directories
  models_dir: "models"
  weights_dir: "models/weights"
  logs_dir: "logs"
  results_dir: "results"
  
  # YOLO training paths
  yolo_dataset_yaml: "Datasets/pothole_dataset.yaml"
  yolo_train_results: "models/yolo_training"

# -----------------------------------------------------------------------------
# Vision Pipeline (YOLOv8) Configuration
# -----------------------------------------------------------------------------
vision:
  # Model settings
  model_type: "yolov8n"  # nano model for speed; options: yolov8n, yolov8s, yolov8m, yolov8l, yolov8x
  pretrained_weights: "yolov8n.pt"
  trained_weights: "models/weights/pothole_yolov8n_best.pt"
  
  # Training hyperparameters
  training:
    epochs: 100
    batch_size: 16
    image_size: 640
    patience: 20  # early stopping patience
    optimizer: "auto"
    lr0: 0.01  # initial learning rate
    lrf: 0.01  # final learning rate ratio
    momentum: 0.937
    weight_decay: 0.0005
    warmup_epochs: 3.0
    augment: true
    
  # Inference settings
  inference:
    confidence_threshold: 0.25
    iou_threshold: 0.45
    max_detections: 100
    
  # Feature extraction
  features:
    extract_confidence: true
    extract_bbox_area: true
    extract_aspect_ratio: true
    normalize_bbox_area: true  # Normalize by image area

# -----------------------------------------------------------------------------
# Accelerometer Pipeline Configuration
# -----------------------------------------------------------------------------
accelerometer:
  # Sensor specifications (MPU6050)
  sensor:
    sample_rate_hz: 50
    accelerometer_range_g: 2  # ±2g, ±4g, ±8g, ±16g
    
  # Sliding window settings
  windowing:
    window_size_samples: 50  # 1 second window at 50Hz
    window_overlap_ratio: 0.5  # 50% overlap
    min_window_samples: 25
    
  # Signal processing
  signal_processing:
    apply_lowpass_filter: true
    lowpass_cutoff_hz: 10.0
    filter_order: 4
    remove_baseline: true
    baseline_method: "mean"  # options: mean, median, highpass
    
  # Feature extraction
  features:
    - "peak_acceleration"
    - "rms_vibration"
    - "peak_to_peak"
    - "mean_acceleration"
    - "std_acceleration"
    - "crest_factor"
    - "zero_crossing_rate"
    
  # Severity classifier
  classifier:
    model_type: "random_forest"  # options: random_forest, gradient_boosting, xgboost
    trained_model: "models/weights/severity_classifier.pkl"
    scaler: "models/weights/severity_scaler.pkl"
    
    # Random Forest hyperparameters
    random_forest:
      n_estimators: 100
      max_depth: 10
      min_samples_split: 5
      min_samples_leaf: 2
      random_state: 42
      
  # Severity thresholds (for rule-based fallback)
  severity_thresholds:
    low:
      max_peak_g: 0.5
      max_rms_g: 0.15
    medium:
      max_peak_g: 1.5
      max_rms_g: 0.5
    high:
      min_peak_g: 1.5
      min_rms_g: 0.5

# -----------------------------------------------------------------------------
# Multimodal Fusion Configuration
# -----------------------------------------------------------------------------
fusion:
  # Fusion method
  method: "rule_based"  # options: rule_based, ml_based, weighted_average
  
  # Rule-based fusion thresholds
  rule_based:
    # Detection thresholds
    vision_confidence_threshold: 0.5
    accel_peak_threshold: 0.3
    accel_rms_threshold: 0.15
    
    # Fusion logic weights
    vision_weight: 0.6
    accel_weight: 0.4
    
    # Combined decision threshold
    combined_detection_threshold: 0.5
    
    # Severity override rules
    severity_rules:
      - name: "high_impact"
        condition: "accel_peak > 2.0 or accel_rms > 0.8"
        severity: "high"
      - name: "large_visual"
        condition: "bbox_area_ratio > 0.1 and vision_conf > 0.8"
        severity: "high"
        
  # ML-based fusion (optional)
  ml_based:
    model_type: "random_forest"
    trained_model: "models/weights/fusion_classifier.pkl"
    features:
      - "vision_confidence"
      - "bbox_area_normalized"
      - "bbox_aspect_ratio"
      - "accel_peak"
      - "accel_rms"
      - "accel_peak_to_peak"

# -----------------------------------------------------------------------------
# Logging & Events Configuration
# -----------------------------------------------------------------------------
logging:
  # Log levels: DEBUG, INFO, WARNING, ERROR, CRITICAL
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  
  # File logging
  file_logging: true
  log_file: "logs/pothole_detection.log"
  max_file_size_mb: 10
  backup_count: 5
  
  # Event database
  event_database:
    type: "sqlite"  # options: sqlite, json
    path: "logs/pothole_events.db"
    
# -----------------------------------------------------------------------------
# GPS Simulation Configuration
# -----------------------------------------------------------------------------
gps:
  # Simulation mode (for offline demo)
  simulation_mode: true
  
  # Default coordinates (when no GPS data available)
  default_location:
    latitude: 40.4533
    longitude: -79.9463
    
  # Coordinate jitter (for demo purposes)
  jitter_enabled: true
  jitter_radius_meters: 5.0

# -----------------------------------------------------------------------------
# Alert System Configuration
# -----------------------------------------------------------------------------
alerts:
  enabled: true
  
  # Console alerts
  console:
    enabled: true
    show_severity_color: true
    
  # Sound alerts (future)
  sound:
    enabled: false
    high_severity_sound: "assets/sounds/alert_high.wav"
    medium_severity_sound: "assets/sounds/alert_medium.wav"
    
  # Debouncing (prevent duplicate alerts)
  debounce:
    enabled: true
    window_seconds: 2.0
    min_distance_meters: 5.0

# -----------------------------------------------------------------------------
# Demo Application Configuration
# -----------------------------------------------------------------------------
demo:
  # Sample data for demo
  sample_image: "Datasets/images/vlcsnap-00001.jpg"
  sample_accel_csv: "Datasets/Pothole/trip1_sensors.csv"
  sample_pothole_csv: "Datasets/Pothole/trip1_potholes.csv"
  
  # Visualization
  visualization:
    show_detections: true
    save_visualizations: true
    output_dir: "results/demo_outputs"
    
  # Demo mode settings
  continuous_mode: false
  frame_delay_ms: 100
